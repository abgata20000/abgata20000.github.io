
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>AB Lab</title>
  <meta name="author" content="abgata20000">

  
  <meta name="description" content="参考URL: Nginxでリバースプロキシを設定し、Apacheと共存させる nginxでリバースプロキシした際にIP情報を正しく取れるようにモジュールを追加 1
2
3
4
5
6
7
sudo yum install httpd-devel cd /root/tmp
wget http:// &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://blog.abgata.org/blog/page/5">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="AB Lab" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

<script>
$(document).ready( function () {
   $("a[href^='http']:not([href*='" + location.hostname + "'])").attr('target', '_blank');
})
</script>

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-50444253-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">AB Lab</a></h1>
  
    <h2>abgata20000 blog.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:blog.abgata.org" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/12/22/nginx_with_apache/">Nginxとapacheの共存</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-12-22T09:00:00+09:00" pubdate data-updated="true">Dec 22<span>nd</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>参考URL:</h3>

<ul>
<li><a href="http://abeerforyou.com/?p=430">Nginxでリバースプロキシを設定し、Apacheと共存させる</a></li>
</ul>


<h2>nginxでリバースプロキシした際にIP情報を正しく取れるようにモジュールを追加</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo yum install httpd-devel
</span><span class='line'>
</span><span class='line'>cd /root/tmp
</span><span class='line'>wget http://www.openinfo.co.uk/apache/extract_forwarded-2.0.2.tar.gz
</span><span class='line'>tar zxf extract_forwarded-2.0.2.tar.gz
</span><span class='line'>cd extract_forwarded
</span><span class='line'>apxs -i -c -a mod_extract_forwarded.c</span></code></pre></td></tr></table></div></figure>


<h2>apacheの実行ユーザーとポートを変更</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>vim /etc/httpd/conf/httpd.conf</span></code></pre></td></tr></table></div></figure>


<h5>/etc/httpd/conf/httpd.conf</h5>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Listen 8080
</span><span class='line'>
</span><span class='line'>#####
</span><span class='line'>User nginx
</span><span class='line'>Group nginx
</span><span class='line'>#####
</span><span class='line'>ServerName sample.jp:8080
</span><span class='line'>
</span><span class='line'># 最終行に追加
</span><span class='line'>MEForder refuse,accept
</span><span class='line'>MEFrefuse all
</span><span class='line'># Nginx（リバースプロキシ）のIPアドレス
</span><span class='line'>MEFaccept 127.0.0.1
</span><span class='line'>
</span><span class='line'>
</span><span class='line'># ヴァーチャルホスト使っている場合はヴァーチャルホストのポートも変更</span></code></pre></td></tr></table></div></figure>


<p>apacheを再起動して設定を反映</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>service httpd restart</span></code></pre></td></tr></table></div></figure>


<h2>nginxでの転送設定</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cd /etc/nginx/conf.d
</span><span class='line'>vim default.conf</span></code></pre></td></tr></table></div></figure>


<h5>default.conf</h5>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>#デフォルトサーバー
</span><span class='line'>server {
</span><span class='line'>    listen       80;
</span><span class='line'>    server_name  backend;
</span><span class='line'>
</span><span class='line'>    # このサーバへの全てのアクセスを転送
</span><span class='line'>    location / {
</span><span class='line'>            proxy_pass http://127.0.0.1:8080;
</span><span class='line'>            proxy_redirect                         off;
</span><span class='line'>
</span><span class='line'>            # この設定がなくても.htaccessでの制限は可能。
</span><span class='line'>            # ただし、cgi等から参照した際にNginxのIPアドレスになる。
</span><span class='line'>            proxy_set_header Host                   $host;
</span><span class='line'>
</span><span class='line'>            proxy_set_header X-Real-IP              $remote_addr;
</span><span class='line'>
</span><span class='line'>            # 以下は、cgi等で明示的に利用していなければ、有効にする必要なし。
</span><span class='line'>            proxy_set_header X-Forwarded-Host      $host;
</span><span class='line'>            proxy_set_header X-Forwarded-Server    $host;
</span><span class='line'>
</span><span class='line'>            # この設定がなくてもcgi等から正しいIPを確認可能。
</span><span class='line'>            # ただし、.htaccessでの制限は不可。
</span><span class='line'>            proxy_set_header X-Forwarded-For        $proxy_add_x_forwarded_for;
</span><span class='line'>    }
</span><span class='line'>}
</span><span class='line'>
</span></code></pre></td></tr></table></div></figure>


<p>最初に↓入れたほうがいいかも？？</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># キャッシュ関連設定
</span><span class='line'>proxy_cache_path  /var/cache/nginx levels=1:2 keys_zone=czone:4m max_size=50m inactive=120m;
</span><span class='line'>proxy_temp_path   /var/tmp/nginx;
</span><span class='line'>proxy_cache_key   "$scheme://$host$request_uri";
</span><span class='line'>proxy_set_header  Host               $host;
</span><span class='line'>proxy_set_header  X-Real-IP          $remote_addr;
</span><span class='line'>proxy_set_header  X-Forwarded-Host   $host;
</span><span class='line'>proxy_set_header  X-Forwarded-Server $host;
</span><span class='line'>proxy_set_header  X-Forwarded-For    $proxy_add_x_forwarded_for;
</span><span class='line'>
</span><span class='line'># バックエンドサーバ−（Apache）設定
</span><span class='line'>upstream backend {
</span><span class='line'>    # ip_hash;
</span><span class='line'>    server 127.0.0.1:8080;
</span><span class='line'>}
</span></code></pre></td></tr></table></div></figure>


<p>nginxを再起動して設定を反映</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>service nginx restart</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/12/22/nginx_install/">Nginxのインストール</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-12-22T09:00:00+09:00" pubdate data-updated="true">Dec 22<span>nd</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>vim /etc/yum.repos.d/nginx.repo</span></code></pre></td></tr></table></div></figure>


<h5>/etc/yum.repos.d/nginx.repo</h5>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[nginx]
</span><span class='line'>name=nginx repo
</span><span class='line'>baseurl=http://nginx.org/packages/centos/$releasever/$basearch/
</span><span class='line'>gpgcheck=0
</span><span class='line'>enabled=1</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo yum install -y nginx
</span><span class='line'>
</span><span class='line'>cd /etc/nginx
</span><span class='line'>sudo mkdir sites-avalable
</span><span class='line'>sudo mkdir sites-enabled
</span><span class='line'># sudo rm -f conf.d/*.conf
</span><span class='line'>
</span><span class='line'>cd conf.d
</span><span class='line'>cp default.conf default.conf.org
</span><span class='line'>cp example_ssl.conf example_ssl.conf.org
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>cp /etc/nginx/nginx.conf /etc/nginx/nginx.conf.org
</span><span class='line'>
</span><span class='line'>sudo vim /etc/nginx/nginx.conf</span></code></pre></td></tr></table></div></figure>


<h5>/etc/nginx/nginx.conf</h5>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># 下から二行目に追加
</span><span class='line'>
</span><span class='line'>include /etc/nginx/sites-enabled/*;
</span></code></pre></td></tr></table></div></figure>


<h1>自動起動をON</h1>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>service nginx start
</span><span class='line'>
</span><span class='line'>chkconfig nginx on
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/12/22/mysql_replication/">MySQLのレプリケーション設定</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-12-22T09:00:00+09:00" pubdate data-updated="true">Dec 22<span>nd</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>マスター側設定</h2>

<h3>レプリケーション用のユーザーを作成</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>GRANT REPLICATION SLAVE ON *.* TO repl@% IDENTIFIED BY 'password';</span></code></pre></td></tr></table></div></figure>


<h3>my.cnf(winの場合はmy.ini)を修正（追加）</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[mysqld]
</span><span class='line'>log-bin = mysql-bin
</span><span class='line'>server-id = 1001</span></code></pre></td></tr></table></div></figure>


<h3>mysqlを再起動</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>service mysqld restart</span></code></pre></td></tr></table></div></figure>


<h3>mysqlのスナップショットを作成</h3>

<h4>mysqlにて</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># DBロック
</span><span class='line'>FLUSH TABLES WITH READ LOCK;
</span><span class='line'>
</span><span class='line'># 現在のバイナリポジションを取得
</span><span class='line'>SHOW MASTER STATUS;
</span><span class='line'>
</span><span class='line'># File、Positionはスレーブ側の設定に必要なので控えておく
</span></code></pre></td></tr></table></div></figure>


<h3>別ターミナル等でDBのバックアップを取る(mysqldumpを利用)</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mysqldump -u user -p --all-databases --lock-all-tables &gt; snapshot.db</span></code></pre></td></tr></table></div></figure>


<h3>DBロックを解除</h3>

<h4>mysqlにて</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>UNLOCK TABLES;</span></code></pre></td></tr></table></div></figure>


<h2>スレーブ側設定</h2>

<h3>my.cnfを修正(追加)</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[mysqld]
</span><span class='line'>log-bin=mysql-bin
</span><span class='line'>log_slave_updates #このスレーブを他のマスターとして使いたい場合追加
</span><span class='line'>server-id=1002</span></code></pre></td></tr></table></div></figure>


<h3>マスタで作成したスナップショットを復元</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mysql -u user -p  &lt; snapshot.db</span></code></pre></td></tr></table></div></figure>


<h3>mysqlを再起動</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>service mysqld restart</span></code></pre></td></tr></table></div></figure>


<h3>マスタ情報を登録</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>CHANGE MASTER TO
</span><span class='line'>MASTER_HOST='sample.com',
</span><span class='line'>MASTER_USER='rep-user',
</span><span class='line'>MASTER_PASSWORD='passwd',
</span><span class='line'>MASTER_LOG_FILE='mysql-bin.000001', #マスターのFIle
</span><span class='line'>MASTER_LOG_POS=98; #マスターのPosition</span></code></pre></td></tr></table></div></figure>


<h3>スレーブをスタート</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>START SLAVE;
</span><span class='line'># STOP SLAVE;RESTART SLAVE;RESET SLAVE;</span></code></pre></td></tr></table></div></figure>


<h3>起動確認</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>SHOW SLAVE STATUS\G</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/12/22/mysql_mroonga_install/">Mysqlサーバーの設定(mroonga)</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-12-22T09:00:00+09:00" pubdate data-updated="true">Dec 22<span>nd</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>参考URL:</h3>

<ul>
<li><a href="http://linuxserver.jp/%E3%82%B5%E3%83%BC%E3%83%90%E6%A7%8B%E7%AF%89/db/mysql/%E5%85%A8%E6%96%87%E6%A4%9C%E7%B4%A2-groonga.php">MySQLでgroongaを利用して高速に日本語の全文検索を行う</a></li>
<li><a href="http://groonga.org/ja/docs/install/centos.html#centos-6">2.5. CentOS &mdash; Groonga v4.0.1ドキュメント</a></li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>rpm -ivh http://packages.groonga.org/centos/groonga-release-1.1.0-1.noarch.rpm
</span><span class='line'># --sorceで強制的に上書き
</span><span class='line'>yum makecache
</span><span class='line'>yum -y update
</span><span class='line'>
</span><span class='line'>yum -y install mysql-server
</span><span class='line'># version5.1.67を指定しないとだめかも
</span><span class='line'>
</span><span class='line'>yum install -y groonga groonga-devel groonga-tokenizer-mecab mecab-ipadic mecab-jumandic</span></code></pre></td></tr></table></div></figure>


<h2>MySQLの設定</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cp /etc/my.cnf /etc/my.cnf.org
</span><span class='line'>vim /etc/my.cnf</span></code></pre></td></tr></table></div></figure>


<h2>MySQLの初期設定</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mysql_secure_installation</span></code></pre></td></tr></table></div></figure>


<h2>MySQLを起動</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>service mysqld start
</span><span class='line'>yum -y install mysql-groonga
</span><span class='line'>service mysqld restart
</span><span class='line'>chkconfig mysqld on
</span><span class='line'>mysql -u root -p</span></code></pre></td></tr></table></div></figure>


<h3>利用可能なストレージエンジンを確認</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mysql&gt; SHOW ENGINES \G</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/12/22/mysql_backup/">MySQLのバックアップを自動化</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-12-22T09:00:00+09:00" pubdate data-updated="true">Dec 22<span>nd</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cd
</span><span class='line'>
</span><span class='line'>mkdir backup
</span><span class='line'>mkdir backup/mysql
</span><span class='line'>
</span><span class='line'>vim mysql_backup.sh</span></code></pre></td></tr></table></div></figure>


<h5>mysql_backup.sh</h5>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>#!/bin/sh
</span><span class='line'>
</span><span class='line'># バックアップファイルを何日分残しておくか
</span><span class='line'>period='+7'
</span><span class='line'># バックアップファイルを保存するディレクトリ
</span><span class='line'>dirpath='/path/to/backup/mysql'
</span><span class='line'>#mysql password
</span><span class='line'>mysqlpassword="passwd"
</span><span class='line'>
</span><span class='line'># ファイル名を定義(※ファイル名で日付がわかるようにしておきます)
</span><span class='line'>mydate=`date +%y%m%d%H%M%S`
</span><span class='line'>filename="mysql_$mydate.sql"
</span><span class='line'># mysqldump実行
</span><span class='line'>mysqldump -uroot -p$mysqlpassword -A -E &gt; $dirpath/$filename
</span><span class='line'>
</span><span class='line'># パーミッション変更
</span><span class='line'>chmod 700 $dirpath/$filename
</span><span class='line'>
</span><span class='line'># 古いバックアップファイルを削除
</span><span class='line'>find $dirpath -type f -daystart -mtime $period -exec rm {} \;</span></code></pre></td></tr></table></div></figure>


<h3>実行権限を付与</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>chmod 700 mysql_backup.sh</span></code></pre></td></tr></table></div></figure>


<h2>cronをインストール</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>yum install cronie-anacron
</span><span class='line'># cron.dailyをランダム実行したくない場合は yum -y install cronie-noanacron
</span><span class='line'>
</span><span class='line'>chkconfig --level 2345 crond on
</span><span class='line'>chkconfig --list crond  
</span><span class='line'>
</span><span class='line'>crontab -e
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>0 3 * * * bash /path/to/mysql_backup.sh</span></code></pre></td></tr></table></div></figure>


<h3>設定済みのクーロンを確認</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>crontab -l</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/12/22/mongodb_install/">Mongodbの設定手順</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-12-22T09:00:00+09:00" pubdate data-updated="true">Dec 22<span>nd</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>参考URL</h3>

<ul>
<li><p><a href="http://docs.mongodb.org/manual/tutorial/install-mongodb-on-red-hat-centos-or-fedora-linux/">公式サイト</a></p></li>
<li><p><a href="http://dotinstall.com/lessons/basic_sakura_vps/8021">ドットインストール</a></p></li>
</ul>


<h4>※2ヶ月ほど前と内容が少し変わっていたので、毎回確認したほうがいいかもしれないです。</h4>

<h2>yumでインストールできるようにリポジトリを追加</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo vim /etc/yum.repos.d/mongodb.repo</span></code></pre></td></tr></table></div></figure>


<h5>/etc/yum.repos.d/mongodb.repo</h5>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[mongodb]
</span><span class='line'>name=MongoDB Repository
</span><span class='line'>baseurl=http://downloads-distro.mongodb.org/repo/redhat/os/x86_64/
</span><span class='line'>gpgcheck=0
</span><span class='line'>enabled=1</span></code></pre></td></tr></table></div></figure>


<h2>yumでmongodbをインストール</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo yum update -y
</span><span class='line'>sudo yum install mongo-10gen mongo-10gen-server -y</span></code></pre></td></tr></table></div></figure>


<h2>mongodbを起動</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>service mongod start</span></code></pre></td></tr></table></div></figure>


<h2>起動時に自動起動設定</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>chkconfig mongod on</span></code></pre></td></tr></table></div></figure>


<h2>バージョンを確認</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mongo --version</span></code></pre></td></tr></table></div></figure>


<h2>シェルを起動</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mongo</span></code></pre></td></tr></table></div></figure>


<h2>シェルを終了</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>exit</span></code></pre></td></tr></table></div></figure>


<h2>ユーザー認証をONにする</h2>

<p>※mongod起動時にオプション指定でも可能ですが、毎回指定するの面倒なので設定ファイルを変更しています。</p>

<h2>設定ファイルをバックアップ</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cp /etc/mongod.conf /etc/mongod.conf.org</span></code></pre></td></tr></table></div></figure>


<h2>設定ファイルを変更</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo vim /etc/mongod.conf</span></code></pre></td></tr></table></div></figure>


<h5>/etc/mongod.conf</h5>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>auth = ture</span></code></pre></td></tr></table></div></figure>


<h2>mongodbを再起動</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>service mongod restart</span></code></pre></td></tr></table></div></figure>


<h2>管理者ユーザーの作成</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>use admin
</span><span class='line'>db.addUser("admin","master_passpass")</span></code></pre></td></tr></table></div></figure>


<h2>ユーザー認証</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>db.auth("admin","master_passpass")</span></code></pre></td></tr></table></div></figure>


<h2>管理者ユーザーの確認</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>db.system.users.find()</span></code></pre></td></tr></table></div></figure>


<h2>DBの切り替え</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>use test</span></code></pre></td></tr></table></div></figure>


<h2>ユーザーの作成</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>db.addUser("test_user","test_passpass")</span></code></pre></td></tr></table></div></figure>


<h2>ユーザーの確認</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>db.system.users.find()</span></code></pre></td></tr></table></div></figure>


<h2>ユーザーの削除</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>db.system.users.remove({user:"test"})</span></code></pre></td></tr></table></div></figure>


<h2>ユーザー認証</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>db.auth("test_user","test_passpass")</span></code></pre></td></tr></table></div></figure>


<h2>テストデータの登録</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>db.test.save( { a: 1 } )</span></code></pre></td></tr></table></div></figure>


<h2>テストデータの閲覧</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>db.test.find()</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/12/22/mongodb_for_php/">PHPでmongodbを使えるようにする</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-12-22T09:00:00+09:00" pubdate data-updated="true">Dec 22<span>nd</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>依存パッケージをインストール</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo yum -y install php-pear
</span><span class='line'>sudo yum -y install php-devel
</span><span class='line'>sudo yum -y install httpd-devel
</span><span class='line'>sudo yum -y install gcc
</span><span class='line'>sudo yum -y install make</span></code></pre></td></tr></table></div></figure>


<h2>pcelでインストール</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>pecl install mongo</span></code></pre></td></tr></table></div></figure>


<h2>mongodb用の設定ファイルを追加</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>vim /etc/php.d/mongo.ini</span></code></pre></td></tr></table></div></figure>


<h5>/etc/php.d/mongo.ini</h5>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[mongo]
</span><span class='line'>extension=mongo.so
</span></code></pre></td></tr></table></div></figure>


<h2>apacheを再起動して設定を反映</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>service httpd restart</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/12/22/install_for_gem/">Gemでインストールするもの</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-12-22T09:00:00+09:00" pubdate data-updated="true">Dec 22<span>nd</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>とりあえずインストールしておくと便利そうなものをピックアップ</p>

<p>&#8220;`
gem install sinatragem install sinatra-contribgem install sqlite3gem install bundlergem install hamlgem install activerecordgem install wssegem install xml-simplegem install nokogiri
gem install unicorn
gem install mysql &mdash; &mdash;with-mysql-config=/usr/bin/mysql_config
gem install mysql2 &mdash; &mdash;with-mysql-config=/usr/bin/mysql_config</p>

<p>gem install activerecord-mysql-adapter
gem install activerecord-mysql2-adapter<code>##↓のコマンド実行しないとシンボリックが生成されない？？</code>rbenv rehash&#8220;`</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/12/22/git_push_refresh/">GitのプッシュでHPの更新(反映)</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-12-22T09:00:00+09:00" pubdate data-updated="true">Dec 22<span>nd</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>gitのグローバル設定</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git config --global user.name "abgata20000"
</span><span class='line'>git config --global user.email "abgata@abgata.jp"
</span><span class='line'>git config --global color.ui true</span></code></pre></td></tr></table></div></figure>


<h2>gitの設定確認</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git config -l</span></code></pre></td></tr></table></div></figure>


<h2>現在のディレクトリを共有リポジトリにする</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git init --bare --share</span></code></pre></td></tr></table></div></figure>


<h2>レポジトリをクローンする</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git clone /git/smaple.git</span></code></pre></td></tr></table></div></figure>


<h2>pushされた際のhooks(post-receive)</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cd hooks
</span><span class='line'>vim post-receive</span></code></pre></td></tr></table></div></figure>


<h5>post-receive</h5>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>#!/bin/sh
</span><span class='line'>cd /var/www/vhosts/
</span><span class='line'>git --git-dir=.git pull origin master</span></code></pre></td></tr></table></div></figure>


<p>実行権限を付与</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>chmod +x post-receive</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/12/22/Ruby_Apache/">Rubyをapacheで稼働する</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-12-22T09:00:00+09:00" pubdate data-updated="true">Dec 22<span>nd</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>passengerをインストール</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>gem install passenger
</span><span class='line'>
</span><span class='line'>passenger-install-apache2-module
</span><span class='line'># パスとおっていない場合は場所を探す
</span><span class='line'>
</span><span class='line'>sudo find / -name passenger-install-apache2-module
</span><span class='line'>
</span><span class='line'>sudo yum install -y curl-devel
</span><span class='line'>
</span><span class='line'>/usr/local/rbenv/versions/2.0.0-p247/bin/passenger-install-apache2-module
</span><span class='line'>
</span><span class='line'># 3回くらい質問されるがとりあえずenter連打</span></code></pre></td></tr></table></div></figure>


<h2>インストール完了後のコメント</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>The Apache 2 module was successfully installed.
</span><span class='line'>
</span><span class='line'>Please edit your Apache configuration file, and add these lines:
</span><span class='line'>
</span><span class='line'>   LoadModule passenger_module /usr/local/rbenv/versions/2.0.0-p247/lib/ruby/gems/2.0.0/gems/passenger-4.0.17/buildout/apache2/mod_passenger.so
</span><span class='line'>   PassengerRoot /usr/local/rbenv/versions/2.0.0-p247/lib/ruby/gems/2.0.0/gems/passenger-4.0.17
</span><span class='line'>   PassengerDefaultRuby /usr/local/rbenv/versions/2.0.0-p247/bin/ruby
</span><span class='line'>
</span><span class='line'>After you restart Apache, you are ready to deploy any number of Ruby on Rails
</span><span class='line'>applications on Apache, without any further Ruby on Rails-specific
</span><span class='line'>configuration!
</span><span class='line'>
</span><span class='line'>Press ENTER to continue.
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>--------------------------------------------
</span><span class='line'>Deploying a Ruby on Rails application: an example
</span><span class='line'>
</span><span class='line'>Suppose you have a Rails application in /somewhere. Add a virtual host to your
</span><span class='line'>Apache configuration file and set its DocumentRoot to /somewhere/public:
</span><span class='line'>
</span><span class='line'>   &lt;VirtualHost *:80&gt;
</span><span class='line'>      ServerName www.yourhost.com
</span><span class='line'>      # !!! Be sure to point DocumentRoot to 'public'!
</span><span class='line'>      DocumentRoot /somewhere/public
</span><span class='line'>      &lt;Directory /somewhere/public&gt;
</span><span class='line'>         # This relaxes Apache security settings.
</span><span class='line'>         AllowOverride all
</span><span class='line'>         # MultiViews must be turned off.
</span><span class='line'>         Options -MultiViews
</span><span class='line'>      &lt;/Directory&gt;
</span><span class='line'>   &lt;/VirtualHost&gt;
</span><span class='line'>
</span><span class='line'>And that's it! You may also want to check the Users Guide for security and
</span><span class='line'>optimization tips, troubleshooting and other useful information:
</span><span class='line'>
</span><span class='line'>  /usr/local/rbenv/versions/2.0.0-p247/lib/ruby/gems/2.0.0/gems/passenger-4.0.17/doc/Users guide Apache.html
</span><span class='line'>
</span><span class='line'>Enjoy Phusion Passenger, a product of Phusion (www.phusion.nl) :-)
</span><span class='line'>https://www.phusionpassenger.com
</span><span class='line'>
</span><span class='line'>Phusion Passenger is a trademark of Hongli Lai & Ninh Bui.
</span></code></pre></td></tr></table></div></figure>


<h2>apacheの設定ファイルを変更白みたいなことが書いてあるので変更する</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>vim /etc/httpd/conf.d/passenger.conf</span></code></pre></td></tr></table></div></figure>


<h5>/etc/httpd/conf.d/passenger.conf</h5>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>LoadModule passenger_module /usr/local/rbenv/versions/2.0.0-p247/lib/ruby/gems/2.0.0/gems/passenger-4.0.17/buildout/apache2/mod_passenger.so
</span><span class='line'>PassengerRoot /usr/local/rbenv/versions/2.0.0-p247/lib/ruby/gems/2.0.0/gems/passenger-4.0.17
</span><span class='line'>PassengerDefaultRuby /usr/local/rbenv/versions/2.0.0-p247/bin/ruby</span></code></pre></td></tr></table></div></figure>


<h2>apahceの設定ファイルでドキュメントルート、バーチャルホストを変更</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>vim /etc/httpd/conf/httpd.conf</span></code></pre></td></tr></table></div></figure>


<h5>/etc/httpd/conf/httpd.conf</h5>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>DocumentRoot /var/www/ruby/public</span></code></pre></td></tr></table></div></figure>


<h2>ドキュメントルートのディレクトリ作成</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cd /var/www
</span><span class='line'>mkdir ruby
</span><span class='line'>cd ruby
</span><span class='line'>mkdir public
</span><span class='line'>mkdir tmp</span></code></pre></td></tr></table></div></figure>


<h2>実行用の設定ファイル作成</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>vim config.ru</span></code></pre></td></tr></table></div></figure>


<h5>config.ru</h5>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>require 'bundler'
</span><span class='line'>Bundler.require
</span><span class='line'>
</span><span class='line'>require './app'
</span><span class='line'>
</span><span class='line'>run App
</span></code></pre></td></tr></table></div></figure>


<h2>実行用ファイルの作成</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>class App &lt; Sinatra::Base
</span><span class='line'>  register Sinatra::Reloader
</span><span class='line'>
</span><span class='line'>  get '/' do
</span><span class='line'>      #
</span><span class='line'>      'hello sinatra by apache.'
</span><span class='line'>
</span><span class='line'>  end
</span><span class='line'>end
</span></code></pre></td></tr></table></div></figure>


<p>webブラウザ等でアクセスしてみる</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/6/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/blog/page/4/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>最近の記事</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2014/05/02/vagrant-packege-vb_version_diff/">Vagrantでpackage作成した際にVirtualBoxのVersionが異なる場合の対処法</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/04/28/whenever/">wheneverでRailsのタスクをcronで実行する</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/04/28/webmin_install/">Webminをインストール</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/04/28/ssl_settiong/">SSLの設定</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/04/28/ssl_keyfile/">SSL証明書の発行方法</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHubレポジトリ</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/abgata20000">@abgata20000</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'abgata20000',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - abgata20000 -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'abgata20000';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
